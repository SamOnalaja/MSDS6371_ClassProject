PROC IMPORT DATAFILE='/home/u36301678/Kaggle.Project/train.csv'
		    OUT=train
		    DBMS=CSV
		    REPLACE;
RUN;

/*clean data */
data train2;
set train;
if  LotFrontage = "NA" then lotFrontage = 0;
if  MasVnrArea = "NA" then MasVnrArea = 0;
if GarageYrBlt = "NA" then GarageYrBlt = YearBuilt;
run;

data train3;
  set train2 (rename=(LotFrontage = LotFrontage_char)) ;
  LotFrontage = input(LotFrontage_char,6.);
  drop LotFrontage_char;
run;

/*removing outliers */
data train4;
   set train3;
  if id = "1299" then delete;
  if id = "524" then delete;
  if id = '1183' then delete;
  if id = '347' then delete;
  if id ='496' then delete;
  if id = '1424' then delete;
run;

/* log transformations */
data train5;
set train4;
logSalePrice=log(SalePrice+1);
lLotArea = log(LotArea+1);
lLotFrontage = log(LotFrontage+1);
lMasVnrArea = log(MasVnrArea+1);
lBsmtFinSF1 = log(BsmtFinSF1+1);
lBsmtFinSF2 = log(BsmtFinSF2+1);
lTotalBsmtSF = log(TotalBsmtSF+1);
l_1stFlrSF = log(_1stFlrSF+1);
l_2ndFlrSF = log(_2ndFlrSF+1);
lGarageArea = log(GarageArea+1);
lWoodDeckSF = log(WoodDeckSF+1);
lOpenPorchSF = log(OpenPorchSF+1);
lEnclosedPorch = log(EnclosedPorch+1);
l_3SsnPorch = log(_3SsnPorch+1);
lScreenPorch = log(ScreenPorch+1);
lGrLivArea = log(GrLivArea+1);
lFullBath = log(FullBath+1);
lHalfBath = log(HalfBath+1);
lYearBuilt = log(YearBuilt+1);
lYearRemodAdd = log(YearRemodAdd+1);
GrLivArea2 = GrLivArea**2;
run;

/*removed MSSubclass */
proc glmselect data=train5 plots=all;
Class MSZoning Street LotShape LandContour Utilities LotConfig LandSlope Neighborhood
 Condition1 Condition2 BldgType HouseStyle RoofStyle RoofMatl Exterior1st Exterior2nd MasVnrType Foundation
 BsmtExposure BsmtFinType1 BsmtFinType2 Heating CentralAir Electrical Functional GarageType GarageFinish
 PavedDrive PoolQC Fence MiscFeature SaleType SaleCondition;
model logSalePrice = GrLivArea2 lLotFrontage lLotArea OverallQual OverallCond YearBuilt YearRemodAdd lMasVnrArea BsmtFinSF1 BsmtFinSF2 
lTotalBsmtSF l_1stFlrSF l_2ndFlrSF LowQualFinSF lGrLivArea BsmtFullBath BsmtHalfBath FullBath HalfBath BedroomAbvGr KitchenAbvGr
 TotRmsAbvGrd Fireplaces GarageYrBlt GarageCars lGarageArea lWoodDeckSF lOpenPorchSF lEnclosedPorch l_3SsnPorch lScreenPorch PoolArea
 MiscVal MoSold YrSold | MSSubClass MSZoning Street LotShape LandContour Utilities LotConfig LandSlope Neighborhood 
 Condition1 Condition2 BldgType HouseStyle RoofStyle RoofMatl Exterior1st Exterior2nd MasVnrType Foundation BsmtExposure
 BsmtFinType1 BsmtFinType2 Heating CentralAir Electrical Functional GarageType GarageFinish PavedDrive PoolQC
 Fence MiscFeature SaleType SaleCondition/selection= Stepwise(stop = CV) cvMethod=split(5);
run;

PROC IMPORT DATAFILE='/home/u36301678/Kaggle.Project/test.csv'
		    OUT=test
		    DBMS=CSV
		    REPLACE;
RUN;

/*clean test data */
data test2;
set test;
if  LotFrontage = "NA" then lotFrontage = 0;
if  MasVnrArea = "NA" then MasVnrArea = 0;
if GarageYrBlt = "NA" then GarageYrBlt = YearBuilt;
run;
data test3;
   set test2 (rename=(LotFrontage = LotFrontage_char)) ;
  LotFrontage = input(LotFrontage_char,6.);
run;

/* log transformations for test data */
data test4;
set test3;
logSalePrice=log(SalePrice+1);
lLotArea = log(LotArea+1);
lLotFrontage = log(LotFrontage+1);
lMasVnrArea = log(MasVnrArea+1);
lBsmtFinSF1 = log(BsmtFinSF1+1);
lBsmtFinSF2 = log(BsmtFinSF2+1);
lTotalBsmtSF = log(TotalBsmtSF+1);
l_1stFlrSF = log(_1stFlrSF+1);
l_2ndFlrSF = log(_2ndFlrSF+1);
lGarageArea = log(GarageArea+1);
lWoodDeckSF = log(WoodDeckSF+1);
lOpenPorchSF = log(OpenPorchSF+1);
lEnclosedPorch = log(EnclosedPorch+1);
l_3SsnPorch = log(_3SsnPorch+1);
lScreenPorch = log(ScreenPorch+1);
lGrLivArea = log(GrLivArea+1);
lFullBath = log(FullBath+1);
lHalfBath = log(HalfBath+1);
lYearBuilt = log(YearBuilt+1);
lYearRemodAdd = log(YearRemodAdd+1);
GrLivArea2 = GrLivArea**2;
run;

/* Add SalePrice with blank values */
data test5;
set test4;
SalePrice=.;

/* Combine train and Test */
data combine;
set train5 test5;
run;

proc freq data=train5;

/* removed MSSubClass, Utilities added GrLivArea2 for improved RMSE*/
proc glmselect data=train5 plots=all;
Class MSZoning Street LotShape LandContour LotConfig LandSlope Neighborhood
 Condition1 Condition2 BldgType HouseStyle RoofStyle RoofMatl Exterior1st Exterior2nd MasVnrType Foundation
 BsmtExposure BsmtFinType1 BsmtFinType2 Heating CentralAir Electrical Functional GarageType GarageFinish
 PavedDrive PoolQC Fence MiscFeature SaleType SaleCondition;
model logSalePrice = GrLivArea2 lLotFrontage lLotArea OverallQual OverallCond YearBuilt YearRemodAdd lMasVnrArea BsmtFinSF1 BsmtFinSF2 
lTotalBsmtSF l_1stFlrSF l_2ndFlrSF LowQualFinSF lGrLivArea BsmtFullBath BsmtHalfBath FullBath HalfBath BedroomAbvGr KitchenAbvGr
 TotRmsAbvGrd Fireplaces GarageYrBlt GarageCars lGarageArea lWoodDeckSF lOpenPorchSF lEnclosedPorch l_3SsnPorch lScreenPorch PoolArea
 MiscVal MoSold YrSold | MSZoning Street LotShape LandContour LotConfig LandSlope Neighborhood 
 Condition1 Condition2 BldgType HouseStyle RoofStyle RoofMatl Exterior1st Exterior2nd MasVnrType Foundation BsmtExposure
 BsmtFinType1 BsmtFinType2 Heating CentralAir Electrical Functional GarageType GarageFinish PavedDrive PoolQC
 Fence MiscFeature SaleType SaleCondition/selection= Stepwise(stop = CV) cvMethod=split(5);
run;

proc glmselect data=combine plots=all;
Class MSZoning Street LotShape LandContour LotConfig LandSlope Neighborhood
 Condition1 Condition2 BldgType HouseStyle RoofStyle RoofMatl Exterior1st Exterior2nd MasVnrType Foundation
 BsmtExposure BsmtFinType1 BsmtFinType2 Heating CentralAir Electrical Functional GarageType GarageFinish
 PavedDrive PoolQC Fence MiscFeature SaleType SaleCondition;
model logSalePrice = GrLivArea2 lLotFrontage lLotArea OverallQual OverallCond lYearBuilt lYearRemodAdd lMasVnrArea lBsmtFinSF1 lBsmtFinSF2 
lTotalBsmtSF l_1stFlrSF l_2ndFlrSF LowQualFinSF lGrLivArea BsmtFullBath BsmtHalfBath lFullBath lHalfBath BedroomAbvGr KitchenAbvGr
 TotRmsAbvGrd Fireplaces GarageYrBlt GarageCars lGarageArea lWoodDeckSF lOpenPorchSF lEnclosedPorch l_3SsnPorch lScreenPorch PoolArea
 MiscVal MoSold YrSold | MSZoning Street LotShape LandContour LotConfig LandSlope Neighborhood 
 Condition1 Condition2 BldgType HouseStyle RoofStyle RoofMatl Exterior1st Exterior2nd MasVnrType Foundation BsmtExposure
 BsmtFinType1 BsmtFinType2 Heating CentralAir Electrical Functional GarageType GarageFinish PavedDrive PoolQC
 Fence MiscFeature SaleType SaleCondition/selection= forward(select = cv choose = cv stop = cv) CVDETAILS; 
   output out=results p=Predict;
run;

/* Can't have  negative prediciton values */
/* Must have only two columns with appropriate labels */
data results;
run;
proc univariate data=results;
var logSalePrice Predict;
run;

data results2;
	set results;
	Predict2 = exp(Predict);
	if Predict2 > 0 then SalePrice = Predict2;
	if Predict2 < 0 then Saleprice = ;
	keep id SalePrice;
	where id > 1460;
run;


PROC EXPORT 
DATA=results2 
DBMS= csv
LABEL 
OUTFILE='/home/u36301678/Kaggle.Project/submit.csv'
REPLACE;
run;
